<html ng-app="discussion_board">
<head>
  <title>Discussion Board</title>


  <!-- Bootstrap -->
<!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <!--stylesheet-->
  <link rel="stylesheet" type="text/css" href="/css/mystyle.css">

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>
  <script>

  // PUT ANGULAR CODE HERE
  var discussion_board = angular.module('discussion_board', ['ngRoute']);

  //routes
  discussion_board.config(function ($routeProvider){
    $routeProvider
      .when('/dashboard', {
        templateUrl: '/views/dashboard.html'
      })
      .when('/', {
          templateUrl: '/views/home.html'
        })
      .otherwise({
        redirectTo: '/'
      })
  });

  //home/usersController
  discussion_board.controller('usersController', function($scope, $location, usersFactory) {
    $scope.users = [];

    // usersFactory.index(function(data){
    //   $scope.users = data;
    // })

    $scope.addUser = function(){
      usersFactory.addUser($scope.user_info, function(users){
        console.log($scope.user_info);
        $scope.users = users;
        $scope.new_user = {};

        // console.log("What is happening??");
        $location.path('/dashboard');
      })
    }
  })

  //dashboardController
  discussion_board.controller('dashboardController', function($scope, usersFactory, topicsFactory){
      $scope.topics = [];
      $scope.users = [];

      topicsFactory.index(function(data){
        $scope.topics = data;
      })

      usersFactory.index(function(data){
        $scope.topics = data;
      })

      $scope.addtopic = function(){
        console.log("from controller");
        topicsFactory.addTopic($scope.new_topic, function(topics){
          $scope.topics = topics;
          $scope.new_topic = {};
        });
      }
  })
  

  //topicsController
  discussion_board.controller('topicsController', function($scope, topicsFactory){
      $scope.topics = [];

      topicsFactory.index(function(data){
        $scope.topics = data;
      })



      
  })

  //usersFactory
  discussion_board.factory('usersFactory', function($http){
    var factory = {};
    var users = [];

    factory.index = function(callback) {
      $http.get('/').success(function(output){
        users = output;
        callback(users);
      });
    }
    
    factory.addUser = function(info, callback) {
      
      $http.post('/users', info).success(function(output){
        // users=output;
        callback();
      });
       
    }
    

    return factory;
  })

  //topicsFactory
  discussion_board.factory('topicsFactory', function($http){
    var factory = {};
    var users = [];

    factory.index = function(callback) {
      $http.get('/topics').success(function(output){
        callback();
      });
    }

    factory.addTopic = function(info, callback) {
      console.log("from factory");
      $http.post('/topics', info).success(function(output){
        callback();
      });
    }

    return factory;
  })

  </script>
</head>
<!-- everything in the body is going to use the friends controller (this gives us access to the friends controller $scope) -->
<body>
  <div ng-view="">
        </div>
</body>
</html>